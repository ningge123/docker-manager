(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-07b0d13c"],{"4dd0":function(t,e,n){"use strict";n.d(e,"d",(function(){return s})),n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return r})),n.d(e,"e",(function(){return c})),n.d(e,"f",(function(){return a})),n.d(e,"a",(function(){return l}));var o=n("b775");function s(t){return Object(o["a"])({url:"/mgr/container/list",method:"get",params:t})}function i(t){return Object(o["a"])({url:"/mgr/container/detail",method:"get",params:t})}function r(t){return Object(o["a"])({url:"/mgr/containerInfos",method:"get",params:t})}function c(t){return Object(o["a"])({url:"/mgr/publish",method:"post",data:t})}function a(t){return Object(o["a"])({url:"/mgr/publish/yaml",method:"post",data:t})}function l(t,e){return Object(o["a"])({url:"/mgr/container/"+t,method:"post",data:e})}},"62ed":function(t,e,n){"use strict";n.d(e,"b",(function(){return s})),n.d(e,"a",(function(){return i}));var o=n("b775");function s(t){return console.log("getLogStart:",t),Object(o["a"])({url:"/mgr/log/start",method:"post",data:t})}function i(t){return Object(o["a"])({url:"/mgr/log/close",method:"post",data:t})}},be69:function(t,e,n){"use strict";n.r(e);var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"app-container"},[n("el-cascader",{staticStyle:{width:"500px","margin-right":"10px"},attrs:{disabled:t.isConnected,filterable:"",placeholder:t.$t("目标容器"),clearable:"",options:t.res.containerInfos,props:{expandTrigger:"hover",emitPath:!1}},model:{value:t.form.containerId,callback:function(e){t.$set(t.form,"containerId",e)},expression:"form.containerId"}}),n("el-checkbox",{staticStyle:{"margin-right":"10px"},model:{value:t.showSystemTime,callback:function(e){t.showSystemTime=e},expression:"showSystemTime"}},[t._v(t._s(t.$t("显示日志系统时间"))+" ")]),n("el-button",{staticClass:"filter-item",attrs:{loading:t.loading,type:"primary",icon:"el-icon-search",disabled:t.isConnected},on:{click:function(e){return t.fetchLogData()}}},[t._v(" "+t._s(t.$t("连接日志"))+" ")]),n("el-button",{staticClass:"filter-item",attrs:{loading:t.loading,type:"primary",disabled:!t.isConnected},on:{click:function(e){return t.disconnectLog()}}},[t._v(" "+t._s(t.$t("断开连接"))+" ")]),n("el-link",{attrs:{underline:!1}}),n("div",{staticClass:"console"},t._l(t.listLogs,(function(e){return n("div",{key:e,ref:"log",refInFor:!0,attrs:{id:"log"}},[n("div",[t.showSystemTime?n("span",[t._v(t._s(t.formatDate(e.ts))+" ")]):t._e(),t._v(" "+t._s(e.line)+" ")])])})),0)],1)},s=[],i=n("4dd0"),r=n("62ed"),c=n("ed08"),a={filters:{statusFilter:function(t){var e={published:"success",draft:"gray",deleted:"danger"};return e[t]}},data:function(){return{websock:null,listLogs:[],loading:!0,showSystemTime:!1,isConnected:!1,res:{containerInfos:[]},form:{containerId:""}}},created:function(){this.fetchData()},destroyed:function(){this.disconnectLog()},methods:{fetchData:function(){var t=this;this.loading=!0,Object(i["c"])().then((function(e){for(var n in t.res.containerInfos=e.data,t.res.containerInfos){var o=t.res.containerInfos[n];for(var s in o.children=o.containers,o.label=o.serverName,o.value=o.serverName,o.children){var i=o.children[s];i.label=i.Name+" - "+i.State,i.value=i.Id,o.children[s]=i}t.res.containerInfos[n]=o}t.loading=!1}))},disconnectLog:function(){this.websock&&(this.websock.close(),Object(r["a"])(this.form))},fetchLogData:function(){var t=this;this.form.containerId?(this.loading=!0,this.listLogs=[{ts:"",line:this.$t("正在连接...")}],console.log("fetchLogData",this.form),Object(r["b"])(this.form).then((function(e){t.loading=!1,"100200"===e.code?(t.list=e.data,t.initWebSocket(t.form.containerId)):(t.$message(e.msg),t.listLogs.push({ts:"",line:e.msg}))})).catch((function(e){t.loading=!1,console.log("logstart.error:",e),t.$message(e.msg),t.listLogs.push({ts:"",line:e.msg})}))):this.$message(this.$t("必须选择容器"))},initWebSocket:function(){console.log("location.protocol:",location);var t="http:"===location.protocol?"ws:":"wss",e=t+location.host+"/dockerMgrApi/ws/log?containerId="+this.form.containerId;this.websock=new WebSocket(e),this.websock.onopen=this.websocketonopen,this.websock.onerror=this.websocketonerror,this.websock.onmessage=this.websocketonmessage,this.websock.onclose=this.websocketclose},websocketonopen:function(){this.isConnected=!0,console.log("WebSocket连接成功"),this.listLogs.push({ts:"",line:this.$t("连接成功.")});var t={ch:"base.ht.ping"};this.websocketsend(JSON.stringify(t))},websocketonerror:function(t){this.isConnected=!1,console.log("WebSocket连接发生错误",t),this.listLogs.push({ts:"",line:this.$t("连接发生错误.")})},websocketonmessage:function(t){var e=JSON.parse(t.data);if("docker.container.log.line"===e.ch){this.listLogs.push(e.d);var n=this.$refs.log;n.scrollTop=n.scrollHeight}},websocketsend:function(t){this.websock.send(t)},websocketclose:function(t){this.isConnected=!1,console.log("connection closed ",t),this.listLogs.push({ts:"",line:this.$t("连接已关闭.")})},formatDate:function(t){return Object(c["b"])(t)}}},l=a,d=(n("f6f1"),n("2877")),u=Object(d["a"])(l,o,s,!1,null,"87a3a158",null);e["default"]=u.exports},c09e:function(t,e,n){},f6f1:function(t,e,n){"use strict";n("c09e")}}]);