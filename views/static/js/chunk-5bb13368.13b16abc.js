(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5bb13368"],{2896:function(e,t,o){"use strict";o("6fe3")},"371d":function(e,t,o){"use strict";o.r(t);var l=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"app-container"},[o("div",{staticStyle:{"margin-bottom":"15px"}},[o("el-input",{attrs:{type:"textarea",rows:5,placeholder:"临时记录区域"},model:{value:e.formTmp.tempText,callback:function(t){e.$set(e.formTmp,"tempText",t)},expression:"formTmp.tempText"}})],1),o("el-form",{ref:"form",attrs:{model:e.form,"label-width":"120px"}},[o("el-form-item",{attrs:{label:"容器名称"}},[o("el-input",{attrs:{placeholder:"容器名称"},model:{value:e.form.Name,callback:function(t){e.$set(e.form,"Name",t)},expression:"form.Name"}})],1),o("el-form-item",{attrs:{label:"镜像"}},[o("el-input",{attrs:{placeholder:"docker.io/library/nginx:latest"},model:{value:e.form.Image,callback:function(t){e.$set(e.form,"Image",t)},expression:"form.Image"}})],1),o("el-form-item",{attrs:{label:"内存(M)"}},[o("el-input-number",{staticStyle:{width:"210px"},attrs:{controls:!1,placeholder:"内存，如：128"},model:{value:e.formTmp.Memory,callback:function(t){e.$set(e.formTmp,"Memory",t)},expression:"formTmp.Memory"}}),o("el-input",{staticStyle:{width:"50px"},attrs:{disabled:"",placeholder:"M"}})],1),o("el-form-item",{attrs:{label:"端口映射"}},[o("el-button",{attrs:{type:"success",size:"small",icon:"el-icon-plus"},on:{click:function(t){return e.addPort()}}},[e._v("添加")]),e._l(e.form.Ports,(function(t,l){return o("div",{key:t.key,staticStyle:{"margin-top":"10px"},attrs:{items:e.form.Ports}},[o("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"8080"},model:{value:t.PublicPort,callback:function(o){e.$set(t,"PublicPort",o)},expression:"item.PublicPort"}},[o("template",{slot:"prepend"},[e._v(e._s(t.IP)+":")])],2),o("span",{staticStyle:{color:"#2b2b2b"}},[e._v(" -> ")]),o("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"8080"},model:{value:t.PrivatePort,callback:function(o){e.$set(t,"PrivatePort",o)},expression:"item.PrivatePort"}},[o("el-select",{staticStyle:{width:"80px"},attrs:{slot:"append",placeholder:"TCP"},slot:"append",model:{value:t.Type,callback:function(o){e.$set(t,"Type",o)},expression:"item.Type"}},[o("el-option",{attrs:{label:"TCP",value:"tcp"}}),o("el-option",{attrs:{label:"UDP",value:"udp"}}),o("el-option",{attrs:{label:"SCTP",value:"sctp"}})],1)],1),o("el-button",{staticStyle:{"margin-left":"15px"},attrs:{type:"danger",size:"small",icon:"el-icon-delete",circle:""},on:{click:function(o){return e.delPort(t,l)}}})],1)}))],2),o("el-form-item",{attrs:{label:"卷映射"}},[o("el-button",{attrs:{type:"success",size:"small",icon:"el-icon-plus"},on:{click:function(t){return e.addVolume()}}},[e._v("添加")]),o("el-link",{staticStyle:{"margin-left":"10px"},attrs:{type:"info",underline:!1,href:"https://docs.docker.com/storage/bind-mounts/#start-a-container-with-a-bind-mount"}},[e._v("Bind模式相当于docker -v参数。如何挂载卷？")]),e._l(e.formTmp.Volumes,(function(t,l){return o("div",{key:t.hostPath,staticStyle:{"margin-top":"10px"},attrs:{items:e.formTmp.Volumes}},[o("el-input",{staticStyle:{width:"400px"},attrs:{placeholder:"源地址(宿主机地址)"},model:{value:t.Source,callback:function(o){e.$set(t,"Source",o)},expression:"item.Source"}},[o("el-select",{staticStyle:{width:"100px"},attrs:{slot:"prepend",disabled:"",placeholder:"绑定方式"},slot:"prepend",model:{value:t.Type,callback:function(o){e.$set(t,"Type",o)},expression:"item.Type"}},[o("el-option",{attrs:{label:"Bind",value:"bind"}}),o("el-option",{attrs:{label:"Volume",value:"volume"}}),o("el-option",{attrs:{label:"Tmpfs",value:"tmpfs"}})],1)],1),o("span",{staticStyle:{color:"#2b2b2b"}},[e._v(" : ")]),o("el-input",{staticStyle:{width:"400px"},attrs:{placeholder:"容器内地址"},model:{value:t.Destination,callback:function(o){e.$set(t,"Destination",o)},expression:"item.Destination"}},[o("el-select",{staticStyle:{width:"80px"},attrs:{slot:"append",clearable:"",placeholder:""},slot:"append",model:{value:t.RW,callback:function(o){e.$set(t,"RW",o)},expression:"item.RW"}},[o("el-option",{attrs:{label:"读写",value:":rw"}}),o("el-option",{attrs:{label:"只读",value:":ro"}})],1)],1),o("el-button",{staticStyle:{"margin-left":"15px"},attrs:{type:"danger",size:"small",icon:"el-icon-delete",circle:""},on:{click:function(o){return e.delVolume(t,l)}}})],1)}))],2),o("el-form-item",{attrs:{label:"环境变量"}},[o("el-button",{attrs:{type:"success",size:"small",icon:"el-icon-plus"},on:{click:function(t){return e.addEnv()}}},[e._v("添加")]),e._l(e.formTmp.Env,(function(t,l){return o("div",{key:l,staticStyle:{"margin-top":"10px"},attrs:{value:t,items:e.formTmp.Env}},[o("el-input",{staticStyle:{width:"400px"},attrs:{placeholder:"变量key"},model:{value:t.key,callback:function(o){e.$set(t,"key",o)},expression:"item.key"}}),o("span",{staticStyle:{color:"#2b2b2b"}},[e._v(" = ")]),o("el-input",{staticStyle:{width:"400px"},attrs:{placeholder:"变量值"},model:{value:t.value,callback:function(o){e.$set(t,"value",o)},expression:"item.value"}}),o("el-button",{staticStyle:{"margin-left":"15px"},attrs:{type:"danger",size:"small",icon:"el-icon-delete",circle:""},on:{click:function(o){return e.delEnv(t,l)}}})],1)}))],2),o("el-form-item",{attrs:{label:"日志驱动"}},[o("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.form.LogType,callback:function(t){e.$set(e.form,"LogType",t)},expression:"form.LogType"}},e._l(e.res.logTypes,(function(e){return o("el-option",{key:e.key,attrs:{label:e.name,value:e.name,title:e.summary}})})),1),o("el-link",{staticStyle:{"margin-left":"10px"},attrs:{type:"info",underline:!1,href:"https://docs.docker.com/config/containers/logging/configure/"}},[e._v(" 如何选择日志驱动？")])],1),o("el-form-item",{attrs:{label:"日志配置参数"}},[o("el-button",{attrs:{type:"success",size:"small",icon:"el-icon-plus"},on:{click:function(t){return e.addLogConfig()}}},[e._v("添加")]),e._l(e.formTmp.LogConfig,(function(t,l){return o("div",{key:t.key,staticStyle:{"margin-top":"10px"},attrs:{value:t,items:e.formTmp.LogConfig}},[o("el-input",{staticStyle:{width:"400px"},attrs:{placeholder:"变量key"},model:{value:t.key,callback:function(o){e.$set(t,"key",o)},expression:"item.key"}}),o("span",{staticStyle:{color:"#2b2b2b"}},[e._v(" = ")]),o("el-input",{staticStyle:{width:"400px"},attrs:{placeholder:"变量值"},model:{value:t.value,callback:function(o){e.$set(t,"value",o)},expression:"item.value"}}),o("el-button",{staticStyle:{"margin-left":"15px"},attrs:{type:"danger",size:"small",icon:"el-icon-delete",circle:""},on:{click:function(o){return e.delLogConfig(t,l)}}})],1)}))],2),o("el-form-item",{attrs:{label:"目标服务器"}},[o("el-select",{staticClass:"filter-item",staticStyle:{width:"100%"},attrs:{multiple:"",filterable:"",placeholder:"ServerName",clearable:""},model:{value:e.form.ServerNames,callback:function(t){e.$set(e.form,"ServerNames",t)},expression:"form.ServerNames"}},e._l(e.res.ServerNames,(function(e){return o("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),o("el-form-item",[o("el-button",{staticStyle:{width:"200px"},attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("发布")])],1)],1)],1)},r=[],a=o("4dd0"),n={data:function(){return{res:{ServerNames:[],logTypes:[{name:"json-file",summary:"日志格式化为 JSON。这是 Docker 默认的日志驱动程序。"},{name:"syslog",summary:"将日志消息写入 syslog 工具。需配置syslog地址参数syslog-address，或守护程序必须在主机上运行。"},{name:"journald",summary:"将日志消息写入 journald。journald 守护程序必须在主机上运行。"},{name:"gelf",summary:"将日志消息写入 Graylog Extended Log Format (GELF) 终端，例如 Graylog 或 Logstash。"},{name:"fluentd",summary:"将日志消息写入 fluentd（forward input）。需配置fluentd地址参数fluentd-address，或fluentd守护程序必须在主机上运行。"},{name:"awslogs",summary:"将日志消息写入 Amazon CloudWatch Logs。"},{name:"splunk",summary:"Writes log messages to splunk using the HTTP Event Collector."},{name:"etwlogs",summary:"将日志消息写为 Windows 的 Event Tracing 事件。仅在Windows平台上可用。"},{name:"gcplogs",summary:"将日志消息写入 Google Cloud Platform (GCP) Logging。"},{name:"logentries",summary:"将日志消息写入 Rapid7 Logentries。"}],logTypes2:["json-file","fluentd","journald","syslog","gelf","awslogs","splunk","etwlogs","gcplogs","logentries"]},formTmp:{Ports:[],Env:[],Volumes:[],LogConfig:[],Memory:0,Replicas:1,tempText:""},form:{Image:"",Name:"",Ports:[],Volumes:[],Env:[],ServerNames:[],Memory:0,LogType:"",LogConfig:[]}}},created:function(){this.fetchData()},methods:{onSubmit:function(){var e=this;this.listLoading=!0;var t=[];for(var o in this.formTmp.Ports){var l=this.formTmp.Ports[o],r=l.IP;l.PublicPort&&l.PublicPort.length>0&&(r+=(r.length>0?":":"")+l.PublicPort),t.push((r.length>0?"->":"")+l.PrivatePort+"/"+l.Type)}var n=[];for(var s in this.formTmp.Env){var i=this.formTmp.Env[s];n.push(i.key+"="+i.value)}var m=[];for(var c in this.formTmp.Volumes){var u=this.formTmp.Volumes[c];m.push(u.Source+":"+u.Destination+u.RW)}var p={};for(var f in this.formTmp.LogConfig){var d=this.formTmp.LogConfig[f];p[d.key]=d.value}this.form.Env=n,this.form.Volumes=m,this.form.LogConfig=p,this.form.Memory=1024*this.formTmp.Memory*1024,console.log("this.formTmp:",this.formTmp),console.log("this.form:",this.form),Object(a["f"])(this.form).then((function(t){e.$message("发布成功"),e.listLoading=!1}))},onCancel:function(){this.$message({message:"cancel!",type:"warning"})},fetchData:function(){var e=this;this.listLoading=!0,Object(a["e"])().then((function(t){e.res.ServerNames=t.data,e.listLoading=!1}))},addPort:function(){this.form.Ports.push({PublicPort:"",PrivatePort:"",IP:"0.0.0.0",Type:"tcp"})},delPort:function(e,t){this.$delete(this.form.Ports,t)},addVolume:function(){this.formTmp.Volumes.push({Source:"",Destination:"",RW:"",Mode:"",Type:"bind",Propagation:"rprivate"})},delVolume:function(e,t){this.$delete(this.formTmp.Volumes,t)},addEnv:function(){this.formTmp.Env.push({key:"",value:""})},delEnv:function(e,t){this.$delete(this.formTmp.Env,t)},addLogConfig:function(){this.formTmp.LogConfig.push({key:"",value:""})},delLogConfig:function(e,t){this.$delete(this.formTmp.LogConfig,t)}}},s=n,i=(o("2896"),o("2877")),m=Object(i["a"])(s,l,r,!1,null,"430d4562",null);t["default"]=m.exports},"4dd0":function(e,t,o){"use strict";o.d(t,"d",(function(){return r})),o.d(t,"e",(function(){return a})),o.d(t,"c",(function(){return n})),o.d(t,"b",(function(){return s})),o.d(t,"f",(function(){return i})),o.d(t,"a",(function(){return m}));var l=o("b775");function r(e){return Object(l["a"])({url:"/mgr/servers",method:"get",params:e})}function a(e){return Object(l["a"])({url:"/mgr/serverNames",method:"get",params:e})}function n(e){return Object(l["a"])({url:"/mgr/containers",method:"get",params:e})}function s(e){return Object(l["a"])({url:"/mgr/containerInfos",method:"get",params:e})}function i(e){return Object(l["a"])({url:"/mgr/publish",method:"post",data:e})}function m(e,t){return Object(l["a"])({url:"/mgr/container/"+e,method:"post",data:t})}},"6fe3":function(e,t,o){}}]);