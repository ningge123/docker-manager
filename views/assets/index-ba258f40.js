import{p as M,a as j}from"./container-b2a204d9.js";import{g as L}from"./server-27da3342.js";import{d as O,k as B,G as R,H as z,I as x,_ as E,o as c,c as v,J as W,r as y,a as S,b as t,t as _,w as r,e as V,F as P,C as w,y as U,p as D,f as N}from"./index-a7dfea41.js";import{E as A}from"./Delete-b08050a7.js";const G={modelValue:{type:String,default:null},width:{type:[String,Number],default:"100%"},height:{type:[String,Number],default:"100%"},language:{type:String,default:"javascript"},readOnly:{type:Boolean,default:!1},theme:{type:String,validator(l){return["vs","hc-black","vs-dark","hc-light"].includes(l)},default:"vs-dark"},options:{type:Object,default(){return{automaticLayout:!0,foldingStrategy:"indentation",renderLineHighlight:"all",selectOnLineNumbers:!0,minimap:{enabled:!0},placeholder:"please enter...",fontSize:16,scrollBeyondLastLine:!1,overviewRulerBorder:!1}}}},$=O({name:"MonacoEditor",props:G,emits:["update:modelValue","change","editor-mounted"],setup(l,{emit:n}){let m;const f=B();let e=!1;const a={},d=s=>(a[s]||(a[s]=new Promise((u,g)=>{const b=document.createElement("script");b.src=s,document.body.append(b),b.addEventListener("load",()=>{u(!0)}),b.onerror=()=>{e=!1,document.body.removeChild(b),g()}})),a[s]),p=()=>e===!0?Promise.resolve():d("https://g.alicdn.com/code/lib/monaco-editor/0.34.1/min/vs/loader.js").then(()=>{window.require.config({paths:{vs:"//g.alicdn.com/code/lib/monaco-editor/0.34.1/min/vs"}}),e=!0}).catch(()=>{e=!1});self.MonacoEnvironment={getWorkerUrl:function(s,u){return`data:text/javascript;charset=utf-8,${encodeURIComponent(`
            self.MonacoEnvironment = {
              baseUrl: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/'
            };
            importScripts('https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs/base/worker/workerMain.js');`)}`}};const k=()=>{p().then(()=>{const s=()=>{f.value&&(m=window.monaco.editor.create(f.value,{value:l.modelValue,language:l.language,theme:l.theme,...l.options}),window.monaco.languages.typescript.javascriptDefaults.setDiagnosticsOptions({noSemanticValidation:!1,noSyntaxValidation:!1}),window.monaco.languages.typescript.javascriptDefaults.setCompilerOptions({target:window.monaco.languages.typescript.ScriptTarget.ES2020,allowNonTsExtensions:!0}),m.onDidChangeModelContent(()=>{const u=m.getValue();n("update:modelValue",u),n("change",u)}),n("editor-mounted",m))};window.require(["vs/editor/editor.main"],s)})};return R(()=>{m?m.dispose():console.log("onBeforeUnmount editor is not")}),z(()=>{k()}),x(()=>l.modelValue,s=>{if(m){const u=m.getValue();s!==u&&m.setValue(s)}}),x(()=>l.options,s=>{m.updateOptions(s)},{deep:!0}),x(()=>l.readOnly,()=>{m.updateOptions({readOnly:l.readOnly})},{deep:!0}),x(()=>l.language,s=>{window.monaco.editor.setModelLanguage(m.getModel(),s)}),{codeEditBox:f}}});const F={ref:"codeEditBox",class:"code-edit-container"};function H(l,n,m,f,e,a){return c(),v("div",F,null,512)}const J=E($,[["render",H],["__scopeId","data-v-639e6d6b"]]);const Y={name:"PublishForm",data(){return{res:{ServerNames:[],logTypes:[{name:"json-file",summary:"日志格式化为 JSON。这是 Docker 默认的日志驱动程序。"},{name:"syslog",summary:"将日志消息写入 syslog 工具。需配置syslog地址参数syslog-address，或守护程序必须在主机上运行。"},{name:"journald",summary:"将日志消息写入 journald。journald 守护程序必须在主机上运行。"},{name:"gelf",summary:"将日志消息写入 Graylog Extended Log Format (GELF) 终端，例如 Graylog 或 Logstash。"},{name:"fluentd",summary:"将日志消息写入 fluentd（forward input）。需配置fluentd地址参数fluentd-address，或fluentd守护程序必须在主机上运行。"},{name:"awslogs",summary:"将日志消息写入 Amazon CloudWatch Logs。"},{name:"splunk",summary:"Writes log messages to splunk using the HTTP Event Collector."},{name:"etwlogs",summary:"将日志消息写为 Windows 的 Event Tracing 事件。仅在Windows平台上可用。"},{name:"gcplogs",summary:"将日志消息写入 Google Cloud Platform (GCP) Logging。"},{name:"logentries",summary:"将日志消息写入 Rapid7 Logentries。"}],logTypes2:["json-file","fluentd","journald","syslog","gelf","awslogs","splunk","etwlogs","gcplogs","logentries"]},tempPlaceholder:"docker run -d --name test-openresty -p 80:80 -p 443:443 -m 512m -e user=root -v /tmp/openresty/nginx/logs:/usr/local/openresty/nginx/logs openresty/openresty:latest",formTmp:{Ports:[],Env:[],Volumes:[],LogConfig:[],Memory:0,Replicas:1,tempText:""},form:{Image:"",Cmd:"",Name:"",Ports:[],Volumes:[],Env:[],ServerNames:[],Memory:0,LogType:"",LogConfig:[],cover:!0},ElIconPlus:W,ElIconDelete:A}},created(){this.fetchData()},methods:{onSubmit(){this.listLoading=!0;const l=[];for(const e in this.formTmp.Ports){const a=this.formTmp.Ports[e];let d=a.IP;a.PublicPort&&a.PublicPort.length>0&&(d+=(d.length>0?":":"")+a.PublicPort),l.push((d.length>0?"->":"")+a.PrivatePort+"/"+a.Type)}const n=[];for(const e in this.formTmp.Env){const a=this.formTmp.Env[e];n.push(a.key+"="+a.value)}const m=[];for(const e in this.formTmp.Volumes){const a=this.formTmp.Volumes[e];m.push(a.Source+":"+a.Destination+a.RW)}const f={};for(const e in this.formTmp.LogConfig){const a=this.formTmp.LogConfig[e];f[a.key]=a.value}this.form.Env=n,this.form.Volumes=m,this.form.LogConfig=f,this.form.Memory=this.formTmp.Memory*1024*1024,console.log("this.form:",this.form),M(this.form).then(e=>{this.$message("发布成功"),this.listLoading=!1})},onCancel(){this.$message({message:"cancel!",type:"warning"})},fetchData(){this.listLoading=!0,L().then(l=>{this.res.ServerNames=l.data,this.listLoading=!1})},addPort(){this.form.Ports.push({PublicPort:"",PrivatePort:"",IP:"0.0.0.0",Type:"tcp"})},delPort(l,n){delete this.form.Ports},addVolume(){this.formTmp.Volumes.push({Source:"",Destination:"",RW:":rw",Mode:"",Type:"bind",Propagation:"rprivate"})},delVolume(l,n){delete this.formTmp.Volumes},addEnv:function(){this.formTmp.Env.push({key:"",value:""})},delEnv(l,n){delete this.formTmp.Env},addLogConfig:function(){this.formTmp.LogConfig.push({key:"",value:""})},delLogConfig(l,n){delete this.formTmp.LogConfig},clear(){this.form.Image="",this.form.Ports=[],this.formTmp.Volumes=[],this.formTmp.Env=[]},toForm(){const l=this.formTmp.tempText,n=["run","-d","--name","-p","-e","-v","-m"],m=l.split(" ");let f="",e="",a=!1,d=!0,p="",k="";this.clear();for(const s in m){if(!d&&!n.includes(m[s])){p===""?(p=m[s],this.form.Image=p):(k+=" "+m[s],this.form.Cmd=k);continue}if(d=n.includes(m[s]),e+=m[s],m[s]==="")if(a)e+=" ";else continue;if(f==="--name")this.form.Name=e;else if(f==="-m"){const u=e.toLowerCase().replaceAll("m","");this.formTmp.Memory=parseInt(u)}else if(f==="-p"){const u=e.split(":");this.form.Ports.push({PublicPort:u[0],PrivatePort:u[1],IP:"0.0.0.0",Type:"tcp"})}else if(f==="-v"){const u=e.split(":");this.formTmp.Volumes.push({Source:u[0],Destination:u[1],RW:":rw",Mode:"",Type:"bind",Propagation:"rprivate"})}else if(f==="-e"){const u=e.split("=");this.formTmp.Env.push({key:u[0],value:u[1]})}(e.startsWith('"')||e.endsWith('"'))&&(a=!a),a||(f=e,e="")}}}},C=l=>(D("data-v-9e5707b6"),l=l(),N(),l),K={class:"app-container"},X={style:{"margin-bottom":"15px"}},q={style:{color:"#90949b","font-size":"14px",padding:"10px"}},Q=["items"],Z=C(()=>S("span",{style:{color:"#2b2b2b"}}," -> ",-1)),ee=["items"],le=C(()=>S("span",{style:{color:"#2b2b2b"}}," : ",-1)),oe=["value","items"],te=C(()=>S("span",{style:{color:"#2b2b2b"}}," = ",-1)),ne=["value","items"],ae=C(()=>S("span",{style:{color:"#2b2b2b"}}," = ",-1));function se(l,n,m,f,e,a){const d=y("el-input"),p=y("el-button"),k=y("el-checkbox"),s=y("el-form-item"),u=y("el-input-number"),g=y("el-option"),b=y("el-select"),h=y("el-link"),I=y("el-form");return c(),v("div",K,[S("div",X,[t(d,{modelValue:e.formTmp.tempText,"onUpdate:modelValue":n[0]||(n[0]=o=>e.formTmp.tempText=o),type:"textarea",rows:5,placeholder:l.$t("临时记录区域")},null,8,["modelValue","placeholder"]),S("div",q," 如下内容，可解析到表单："+_(e.tempPlaceholder),1),t(p,{type:"primary",size:"mini",style:{"margin-top":"10px"},onClick:a.toForm},{default:r(()=>[V(_(l.$t("解析")),1)]),_:1},8,["onClick"])]),t(I,{ref:"form",model:e.form,"label-width":"120px"},{default:r(()=>[t(s,{label:l.$t("容器名称")},{default:r(()=>[t(d,{modelValue:e.form.Name,"onUpdate:modelValue":n[1]||(n[1]=o=>e.form.Name=o),placeholder:l.$t("容器名称")},null,8,["modelValue","placeholder"]),t(k,{modelValue:e.form.cover,"onUpdate:modelValue":n[2]||(n[2]=o=>e.form.cover=o)},{default:r(()=>[V(_(l.$t("如果容器名存在，则覆盖")),1)]),_:1},8,["modelValue"])]),_:1},8,["label"]),t(s,{label:l.$t("镜像")},{default:r(()=>[t(d,{modelValue:e.form.Image,"onUpdate:modelValue":n[3]||(n[3]=o=>e.form.Image=o),placeholder:"docker.io/library/nginx:latest"},null,8,["modelValue"])]),_:1},8,["label"]),t(s,{label:l.$t("内存(M)")},{default:r(()=>[t(u,{modelValue:e.formTmp.Memory,"onUpdate:modelValue":n[4]||(n[4]=o=>e.formTmp.Memory=o),controls:!1,placeholder:l.$t("内存，如：128"),style:{width:"210px"}},null,8,["modelValue","placeholder"]),t(d,{disabled:"",placeholder:"M",style:{width:"50px"}})]),_:1},8,["label"]),t(s,{label:l.$t("端口映射")},{default:r(()=>[t(p,{type:"success",size:"small",icon:e.ElIconPlus,onClick:n[5]||(n[5]=o=>a.addPort())},{default:r(()=>[V(_(l.$t("添加")),1)]),_:1},8,["icon"]),(c(!0),v(P,null,w(e.form.Ports,(o,T)=>(c(),v("div",{key:o.key,items:e.form.Ports,style:{"margin-top":"10px"}},[t(d,{modelValue:o.PublicPort,"onUpdate:modelValue":i=>o.PublicPort=i,placeholder:"8080",style:{width:"200px"}},{prepend:r(()=>[V(_(o.IP)+":",1)]),_:2},1032,["modelValue","onUpdate:modelValue"]),Z,t(d,{modelValue:o.PrivatePort,"onUpdate:modelValue":i=>o.PrivatePort=i,placeholder:"8080",style:{width:"200px"}},{append:r(()=>[t(b,{modelValue:o.Type,"onUpdate:modelValue":i=>o.Type=i,placeholder:"TCP",style:{width:"80px"}},{default:r(()=>[t(g,{label:"TCP",value:"tcp"}),t(g,{label:"UDP",value:"udp"}),t(g,{label:"SCTP",value:"sctp"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["modelValue","onUpdate:modelValue"]),t(p,{type:"danger",style:{"margin-left":"15px"},size:"small",icon:e.ElIconDelete,circle:"",onClick:i=>a.delPort(o,T)},null,8,["icon","onClick"])],8,Q))),128))]),_:1},8,["label"]),t(s,{label:l.$t("卷映射")},{default:r(()=>[t(p,{type:"success",size:"small",icon:e.ElIconPlus,onClick:n[6]||(n[6]=o=>a.addVolume())},{default:r(()=>[V(_(l.$t("添加")),1)]),_:1},8,["icon"]),t(h,{type:"info",underline:!1,href:"https://docs.docker.com/storage/bind-mounts/#start-a-container-with-a-bind-mount",style:{"margin-left":"10px"}},{default:r(()=>[V(_(l.$t("Bind模式相当于docker -v参数。如何挂载卷？")),1)]),_:1}),(c(!0),v(P,null,w(e.formTmp.Volumes,(o,T)=>(c(),v("div",{key:o.hostPath,items:e.formTmp.Volumes,style:{"margin-top":"10px"}},[t(d,{modelValue:o.Source,"onUpdate:modelValue":i=>o.Source=i,placeholder:l.$t("源地址(宿主机地址)"),style:{width:"400px"}},{prepend:r(()=>[t(b,{modelValue:o.Type,"onUpdate:modelValue":i=>o.Type=i,disabled:"",placeholder:l.$t("绑定方式"),style:{width:"100px"}},{default:r(()=>[t(g,{label:"Bind",value:"bind"}),t(g,{label:"Volume",value:"volume"}),t(g,{label:"Tmpfs",value:"tmpfs"})]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"]),le,t(d,{modelValue:o.Destination,"onUpdate:modelValue":i=>o.Destination=i,placeholder:l.$t("容器内地址"),style:{width:"400px"}},{append:r(()=>[t(b,{modelValue:o.RW,"onUpdate:modelValue":i=>o.RW=i,clearable:"",placeholder:"",style:{width:"80px"}},{default:r(()=>[t(g,{label:l.$t("读写"),value:":rw"},null,8,["label"]),t(g,{label:l.$t("只读"),value:":ro"},null,8,["label"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"]),t(p,{type:"danger",style:{"margin-left":"15px"},size:"small",icon:e.ElIconDelete,circle:"",onClick:i=>a.delVolume(o,T)},null,8,["icon","onClick"])],8,ee))),128))]),_:1},8,["label"]),t(s,{label:l.$t("环境变量")},{default:r(()=>[t(p,{type:"success",size:"small",icon:e.ElIconPlus,onClick:n[7]||(n[7]=o=>a.addEnv())},{default:r(()=>[V(_(l.$t("添加")),1)]),_:1},8,["icon"]),(c(!0),v(P,null,w(e.formTmp.Env,(o,T)=>(c(),v("div",{key:T,value:o,items:e.formTmp.Env,style:{"margin-top":"10px"}},[t(d,{modelValue:o.key,"onUpdate:modelValue":i=>o.key=i,placeholder:l.$t("变量key"),style:{width:"400px"}},null,8,["modelValue","onUpdate:modelValue","placeholder"]),te,t(d,{modelValue:o.value,"onUpdate:modelValue":i=>o.value=i,placeholder:l.$t("变量值"),style:{width:"400px"}},null,8,["modelValue","onUpdate:modelValue","placeholder"]),t(p,{type:"danger",style:{"margin-left":"15px"},size:"small",icon:e.ElIconDelete,circle:"",onClick:i=>a.delEnv(o,T)},null,8,["icon","onClick"])],8,oe))),128))]),_:1},8,["label"]),t(s,{label:l.$t("日志驱动")},{default:r(()=>[t(b,{modelValue:e.form.LogType,"onUpdate:modelValue":n[8]||(n[8]=o=>e.form.LogType=o),clearable:"",placeholder:l.$t("请选择")},{default:r(()=>[(c(!0),v(P,null,w(e.res.logTypes,o=>(c(),U(g,{key:o.key,label:o.name,value:o.name,title:o.summary},null,8,["label","value","title"]))),128))]),_:1},8,["modelValue","placeholder"]),t(h,{type:"info",underline:!1,href:"https://docs.docker.com/config/containers/logging/configure/",style:{"margin-left":"10px"}},{default:r(()=>[V(_(l.$t("如何选择日志驱动？")),1)]),_:1})]),_:1},8,["label"]),t(s,{label:l.$t("日志配置参数")},{default:r(()=>[t(p,{type:"success",size:"small",icon:e.ElIconPlus,onClick:n[9]||(n[9]=o=>a.addLogConfig())},{default:r(()=>[V(_(l.$t("添加")),1)]),_:1},8,["icon"]),(c(!0),v(P,null,w(e.formTmp.LogConfig,(o,T)=>(c(),v("div",{key:o.key,value:o,items:e.formTmp.LogConfig,style:{"margin-top":"10px"}},[t(d,{modelValue:o.key,"onUpdate:modelValue":i=>o.key=i,placeholder:l.$t("变量key"),style:{width:"400px"}},null,8,["modelValue","onUpdate:modelValue","placeholder"]),ae,t(d,{modelValue:o.value,"onUpdate:modelValue":i=>o.value=i,placeholder:l.$t("变量值"),style:{width:"400px"}},null,8,["modelValue","onUpdate:modelValue","placeholder"]),t(p,{type:"danger",style:{"margin-left":"15px"},size:"small",icon:e.ElIconDelete,circle:"",onClick:i=>a.delLogConfig(o,T)},null,8,["icon","onClick"])],8,ne))),128))]),_:1},8,["label"]),t(s,{label:l.$t("目标主机")},{default:r(()=>[t(b,{modelValue:e.form.ServerNames,"onUpdate:modelValue":n[10]||(n[10]=o=>e.form.ServerNames=o),multiple:"",filterable:"",placeholder:"ServerName",clearable:"",class:"filter-item",style:{width:"100%"}},{default:r(()=>[(c(!0),v(P,null,w(e.res.ServerNames,o=>(c(),U(g,{key:o,label:o,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),t(s,null,{default:r(()=>[t(p,{type:"primary",style:{width:"200px"},onClick:a.onSubmit},{default:r(()=>[V(_(l.$t("发布")),1)]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])])}const re=E(Y,[["render",se],["__scopeId","data-v-9e5707b6"]]);const me=`version: "2"

services:
  openresty:
    container_name: test-openresty
    image: openresty/openresty:latest
    restart: always
    ports:
      - "80:80"
      - "443:443"
    environment:
      - GET_HOSTS_FROM=dns
    volumes:
      - "/tmp/data/web:/data/web"
      - "/tmp/openresty/nginx/logs:/usr/local/openresty/nginx/logs"
    

`,ie='[{"items":[{"market_type":"forexdata","symbol":"XAUUSD"},{"market_type":"forexdata","symbol":"UKOIL"},{"market_type":"forexdata","symbol":"CORN"}],"name":""},{"items":[{"market_type":"forexdata","symbol":"XAUUSD"},{"market_type":"forexdata","symbol":"XAGUSD"},{"market_type":"forexdata","symbol":"AUTD"},{"market_type":"forexdata","symbol":"AGTD"}],"name":"贵金属"},{"items":[{"market_type":"forexdata","symbol":"CORN"},{"market_type":"forexdata","symbol":"WHEAT"},{"market_type":"forexdata","symbol":"SOYBEAN"},{"market_type":"forexdata","symbol":"SUGAR"}],"name":"农产品"},{"items":[{"market_type":"forexdata","symbol":"UKOIL"},{"market_type":"forexdata","symbol":"USOIL"},{"market_type":"forexdata","symbol":"NGAS"}],"name":"能源化工"}]',de={components:{MonacoEditor:J,PublishForm:re},data(){return{res:{ServerNames:[]},form:{ServerNames:[]},activeName:"2",yamlData:me,jsonData:JSON.parse(ie)}},created(){this.fetchData()},methods:{onSubmit(){const l={serverNames:this.form.ServerNames,yaml:this.yamlData};j(l).then(n=>{this.$message("发布成功")})},fetchData(){this.listLoading=!0,L().then(l=>{this.res.ServerNames=l.data,this.listLoading=!1})}}},ue=l=>(D("data-v-6a8335c3"),l=l(),N(),l),pe={class:"app-container"},ce=ue(()=>S("div",{style:{color:"#90949b","font-size":"14px",padding:"10px"}}," 使用docker compose yaml格式规范 ",-1));function fe(l,n,m,f,e,a){const d=y("publish-form"),p=y("el-tab-pane"),k=y("MonacoEditor"),s=y("el-option"),u=y("el-select"),g=y("el-button"),b=y("el-tabs");return c(),v("div",pe,[t(b,{modelValue:e.activeName,"onUpdate:modelValue":n[3]||(n[3]=h=>e.activeName=h),type:"card"},{default:r(()=>[t(p,{label:"表单模式",name:"2"},{default:r(()=>[t(d)]),_:1}),t(p,{label:"Yaml模式",name:"3"},{default:r(()=>[ce,t(k,{modelValue:e.yamlData,"onUpdate:modelValue":n[0]||(n[0]=h=>e.yamlData=h),language:"yaml",width:"100%",height:"100%"},null,8,["modelValue"]),t(u,{modelValue:e.form.ServerNames,"onUpdate:modelValue":n[1]||(n[1]=h=>e.form.ServerNames=h),multiple:"",filterable:"",placeholder:"ServerName",clearable:"",class:"filter-item",style:{"margin-top":"10px","margin-bottom":"10px","margin-right":"10px"}},{default:r(()=>[(c(!0),v(P,null,w(e.res.ServerNames,h=>(c(),U(s,{key:h,label:h,value:h},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(g,{type:"primary",style:{width:"200px"},onClick:a.onSubmit},{default:r(()=>[V(_(l.$t("发布")),1)]),_:1},8,["onClick"])]),_:1}),t(p,{label:"Json模式",name:"4",disabled:""},{default:r(()=>[t(k,{modelValue:e.jsonData,"onUpdate:modelValue":n[2]||(n[2]=h=>e.jsonData=h),language:"json",width:"100%",height:"100%"},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])])}const be=E(de,[["render",fe],["__scopeId","data-v-6a8335c3"]]);export{be as default};
